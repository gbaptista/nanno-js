!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.nanno=n():e.nanno=n()}(self,(function(){return(()=>{"use strict";var e={9:(e,n,r)=>{function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}r.r(n),r.d(n,{default:()=>me});const o=function(){function e(n){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),e.validate(n,"pixi","Application"),e.validate(n,"gsap","registerPlugin"),e.validate(n,"gsapPixiPlugin","registerPIXI"),e.validateFont(n.font),n.gsapPixiPlugin.registerPIXI(n.pixi),n.gsap.registerPlugin(n.gsapPixiPlugin),n}var n,r;return n=e,r=[{key:"validate",value:function(e,n,r){if("object"!==t(e[n]))throw new Error("Missing ".concat(n," dependency."));if("function"!=typeof e[n][r])throw new Error("Injected ".concat(n," is not valid. Missing function ").concat(r,"."))}},{key:"validateFont",value:function(e){if("function"!=typeof e)throw new Error("Invalid font dependency.")}}],null&&a(n.prototype,null),r&&a(n,r),e}();function i(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const c=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"removeVoids",value:function(n){var r=[];return n.split("\n").forEach((function(n){""!==n.trim()&&r.push(e.rightTrim(n))})),r.join("\n")}},{key:"rightTrim",value:function(e){return e.replace(/\s+$/,"")}}],null&&i(n.prototype,null),r&&i(n,r),e}();function u(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const l=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(e){var n={sections:[],markup:[]};return e.split(/^-{1,}/gm).forEach((function(e){var r=e.split(/^(>|scene|\^|movie)/m),t=r.shift(),a="";r.forEach((function(e,t){void 0!==r[t+1]&&""!==r[t+1].trim()&&(">"===e.trim()||"scene"===e.trim()?a+=e+r[t+1]:"^"!==e.trim()&&"movie"!==e.trim()||n.markup.push(e+r[t+1]))})),a=c.removeVoids(a);var o={},i=!1;void 0!==t&&""!==t.trim()&&(i=!0,o.stage=c.removeVoids(t)),void 0!==a&&""!==a.trim()&&(i=!0,o.markup=c.removeVoids(a)),i&&(o.position=n.sections.length+1,n.sections.push(o))})),n.markup=c.removeVoids(n.markup.join("\n").split(/^movie|^\^/m).join("\n")),n}}],null&&u(n.prototype,null),r&&u(n,r),e}(),s={black:"#000000",navy:"#000080",darkblue:"#00008b",mediumblue:"#0000cd",blue:"#0000ff",darkgreen:"#006400",green:"#008000",teal:"#008080",darkcyan:"#008b8b",deepskyblue:"#00bfff",darkturquoise:"#00ced1",mediumspringgreen:"#00fa9a",lime:"#00ff00",springgreen:"#00ff7f",aqua:"#00ffff",cyan:"#00ffff",midnightblue:"#191970",dodgerblue:"#1e90ff",lightseagreen:"#20b2aa",forestgreen:"#228b22",seagreen:"#2e8b57",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",limegreen:"#32cd32",mediumseagreen:"#3cb371",turquoise:"#40e0d0",royalblue:"#4169e1",steelblue:"#4682b4",darkslateblue:"#483d8b",mediumturquoise:"#48d1cc",indigo:"#4b0082",darkolivegreen:"#556b2f",cadetblue:"#5f9ea0",cornflowerblue:"#6495ed",rebeccapurple:"#663399",mediumaquamarine:"#66cdaa",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6a5acd",olivedrab:"#6b8e23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7b68ee",lawngreen:"#7cfc00",chartreuse:"#7fff00",aquamarine:"#7fffd4",maroon:"#800000",purple:"#800080",olive:"#808000",gray:"#808080",grey:"#808080",skyblue:"#87ceeb",lightskyblue:"#87cefa",blueviolet:"#8a2be2",darkred:"#8b0000",darkmagenta:"#8b008b",saddlebrown:"#8b4513",darkseagreen:"#8fbc8f",lightgreen:"#90ee90",mediumpurple:"#9370db",darkviolet:"#9400d3",palegreen:"#98fb98",darkorchid:"#9932cc",yellowgreen:"#9acd32",sienna:"#a0522d",brown:"#a52a2a",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",lightblue:"#add8e6",greenyellow:"#adff2f",paleturquoise:"#afeeee",lightsteelblue:"#b0c4de",powderblue:"#b0e0e6",firebrick:"#b22222",darkgoldenrod:"#b8860b",mediumorchid:"#ba55d3",rosybrown:"#bc8f8f",darkkhaki:"#bdb76b",silver:"#c0c0c0",mediumvioletred:"#c71585",indianred:"#cd5c5c",peru:"#cd853f",chocolate:"#d2691e",tan:"#d2b48c",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",thistle:"#d8bfd8",orchid:"#da70d6",goldenrod:"#daa520",palevioletred:"#db7093",crimson:"#dc143c",gainsboro:"#dcdcdc",plum:"#dda0dd",burlywood:"#deb887",lightcyan:"#e0ffff",lavender:"#e6e6fa",darksalmon:"#e9967a",violet:"#ee82ee",palegoldenrod:"#eee8aa",lightcoral:"#f08080",khaki:"#f0e68c",aliceblue:"#f0f8ff",honeydew:"#f0fff0",azure:"#f0ffff",sandybrown:"#f4a460",wheat:"#f5deb3",beige:"#f5f5dc",whitesmoke:"#f5f5f5",mintcream:"#f5fffa",ghostwhite:"#f8f8ff",salmon:"#fa8072",antiquewhite:"#faebd7",linen:"#faf0e6",lightgoldenrodyellow:"#fafad2",oldlace:"#fdf5e6",red:"#ff0000",fuchsia:"#ff00ff",magenta:"#ff00ff",deeppink:"#ff1493",orangered:"#ff4500",tomato:"#ff6347",hotpink:"#ff69b4",coral:"#ff7f50",darkorange:"#ff8c00",lightsalmon:"#ffa07a",orange:"#ffa500",lightpink:"#ffb6c1",pink:"#ffc0cb",gold:"#ffd700",peachpuff:"#ffdab9",navajowhite:"#ffdead",moccasin:"#ffe4b5",bisque:"#ffe4c4",mistyrose:"#ffe4e1",blanchedalmond:"#ffebcd",papayawhip:"#ffefd5",lavenderblush:"#fff0f5",seashell:"#fff5ee",cornsilk:"#fff8dc",lemonchiffon:"#fffacd",floralwhite:"#fffaf0",snow:"#fffafa",yellow:"#ffff00",lightyellow:"#ffffe0",ivory:"#fffff0",white:"#ffffff"};function f(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const p=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(n){var r=n.toString().replace("0x","#");if(r.startsWith("#"))return e.parseRGB(r);var t=r.replace(/\W/,"").trim().toLowerCase();return void 0!==s[t]?e.parseRGB(s[t]):parseInt(r,10)}},{key:"parseRGB",value:function(e){for(var n=e;n.length<7;)n+=n.slice(-1);return parseInt(n.replace("#","0x"),16)}}],null&&f(n.prototype,null),r&&f(n,r),e}();function d(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],t=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(t=(i=c.next()).done)&&(r.push(i.value),!n||r.length!==n);t=!0);}catch(e){a=!0,o=e}finally{try{t||null==c.return||c.return()}finally{if(a)throw o}}return r}}(e,n)||m(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,n){if(e){if("string"==typeof e)return v(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,n):void 0}}function v(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function h(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const b=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(n){var r={};return e.parseSource(n).forEach((function(n){var t=e.parseSection(n);t.objects.forEach((function(e){void 0===r[e]&&(r[e]={}),Object.keys(t.properties).forEach((function(n){var a=t.properties[n];if("text-content"===n)/^"/.exec(a)?r[e][n]=a.replace(/^"/,"").replace(/"$/m,""):r[e][n]=a;else if("position"===n){var o=d(a.split("/"),2),i=o[0],c=o[1];r[e].column=parseFloat(i),r[e].row=parseFloat(c)}else/color/.exec(n)?r[e][n]=p.parse(a):"false"===a?r[e][n]=!1:"true"===a?r[e][n]=!0:"no"===a?r[e][n]=!1:"yes"===a?r[e][n]=!0:/width|height|repeat|column|row/.exec(n)?r[e][n]=parseInt(a,10):r[e][n]=a}))}))})),r}},{key:"parseSection",value:function(e){for(var n=[],r={},t=e,a=!0,o={};a;)if(a=/\[(.|\n)*?\]/m.exec(t)){var i="{FLOW-".concat(Object.keys(o).length,"}"),c=d(a,1);o[i]=c[0],t=t.replace(a[0],i)}return t.split("\n").forEach((function(e){if(/^\s/.exec(e)){for(var t=e.trim(),a=!0;a;)if(a=/\S+\s+".*?"/.exec(t)){t=t.replace(a[0],"");var i=/\S+\s+/.exec(a[0]),c=a[0].replace(i[0],"");r[i[0].trim()]=c.trim()}if(""!==t.trim())for(var u=t.trim().split(/\s+/);u.length>0;){var l=u.shift(),s=u.shift();s.startsWith("{FLOW-")?r[l]=o[s]:r[l]=s}}else n.push.apply(n,function(e){if(Array.isArray(e))return v(e)}(f=e.split(/\s+/).filter((function(e){return""!==e.trim()})))||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(f)||m(f)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var f})),{objects:n,properties:r}}},{key:"parseSource",value:function(e){var n=[],r="",t=!1;return e.split("\n").forEach((function(e){/^\s/.exec(e)&&(t=!0),/^\S/.exec(e)&&t?(""!==r.trim()&&n.push(c.removeVoids(r)),r=e,t=!1):r+="\n".concat(e)})),""!==r.trim()&&n.push(c.removeVoids(r)),n}}],null&&h(n.prototype,null),r&&h(n,r),e}();function y(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return k(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function g(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const w=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(n){var r,t={},a=[],o="";n.split("").forEach((function(n,i){a.push(i),""===n.trim()&&""!==o?(o=e.translateColumn(o,r),r=o,a.forEach((function(e){t[e]=o})),a=[],o=""):" "!==n&&""!==n&&(o+=n)})),o=e.translateColumn(o,r),a.forEach((function(e){t[e]=o}));var i=Object.values(t).map((function(e){return parseFloat(e)})),c=Math.min.apply(Math,y(i)),u=Math.max.apply(Math,y(i));return{firstColumn:c,lastColumn:u,numberOfColumns:Math.ceil(u),coordinates:t}}},{key:"translateColumn",value:function(e,n){return"."===e?void 0===n?1:Math.floor(n)+1:parseFloat(e)}}],null&&g(n.prototype,null),r&&g(n,r),e}();function j(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function O(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const E=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(n,r){var t={elements:[]},a=r,o=c.removeVoids(n).split("\n"),i=e.buildLinePrefixes(o);if(void 0===a&&!i.includes("column"))throw new Error("Column map missing.");var u=0;return o.forEach((function(n,r){var o,c,l=i[r];switch(l){case"column":a=w.parse(n);break;case"row":var s;o=e.parseLine(n,u,a),u=o.currentRow,o.tokens.length>0&&(s=t.elements).push.apply(s,function(e){if(Array.isArray(e))return j(e)}(c=o.tokens)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(c)||function(e,n){if(e){if("string"==typeof e)return j(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,n):void 0}}(c)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());break;default:throw new Error("Unknown scene instruction: ".concat(l))}})),t.lastRow=u,t.columnMap=a,t}},{key:"parseLine",value:function(n,r,t){var a=n,o=Math.floor(r)+1,i=/^\d+\.?\d*/.exec(a);i?(o=parseFloat(i[0]),a=a.replace(/^\d+\.?\d*/," ".repeat(i[0].length))):a=a.replace(/^\./," ");for(var c={currentRow:o,tokens:[]},u=/(↧|⊹|↥)*(\w+[:/|]".*?"|\w+[:/|]'.*?'|".*?"|'.*?'|\w+[:/|]\w+|\w+)(↧|⊹|↥)*/,l=!0;l;){var s=u.exec(a);if(s){a=a.replace(u," ".repeat(s[0].length));var f=s[0],p=s.index;s[0].match(/↧|⊹|↥/)&&(p+=1),c.tokens.push({token:f,row:o,column:e.positionToColumn(p,t)})}else l=!1}return c}},{key:"positionToColumn",value:function(e,n){var r=n.coordinates[e];return void 0===r&&(r=n.lastColumn),r}},{key:"buildLinePrefixes",value:function(e){return e.map((function(e){if(/\d|\./.test(e[0]))return"row";if(/\s/.test(e[0]))return"column";throw new Error("Unknown scene instruction: ".concat(e[0]))}))}}],null&&O(n.prototype,null),r&&O(n,r),e}(),S={SYMBOLS:{"↧":"hide","↥":"show"}};function x(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],t=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(t=(i=c.next()).done)&&(r.push(i.value),!n||r.length!==n);t=!0);}catch(e){a=!0,o=e}finally{try{t||null==c.return||c.return()}finally{if(a)throw o}}return r}}(e,n)||function(e,n){if(e){if("string"==typeof e)return C(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function P(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const A=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(e){var n,r,t=e;if(e.includes(":")){var a=x(e.split(":"),2);t=a[0],n=a[1]}else if(e.includes("/")){var o=x(e.split("/"),2);t=o[0],n=o[1]}else if(e.includes("|")){var i=x(e.split("|"),2);t=i[0],n=i[1]}void 0!==S.SYMBOLS[t[0]]&&(r=S.SYMBOLS[t[0]],t=t.substring(1)),n&&(n.startsWith('"')||n.startsWith("'"))&&(n=n.substring(1,n.length-1));var c={};return void 0!==n&&(c["text-content"]=n),void 0!==r&&(c.motion=r),{id:t,markup:c}}}],null&&P(n.prototype,null),r&&P(n,r),e}();function T(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const F=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(e,n,r){var t={scenes:[],stage:void 0,columnMap:r,firstScene:n,lastScene:n,leakedBaseMarkup:{}},a=n;if(void 0===a?a=1:a+=1,void 0!==e.stage){var o=E.parse(e.stage,r),i=o.elements.map((function(e){var n=A.parse(e.token);return n.row=e.row,n.column=e.column,n}));t.stage={elements:i},t.columnMap=o.columnMap,t.lastRow=o.lastRow}else t.columnMap=r;if(e.markup){var c=e.markup.split(/^(scene|>)/m);c=c.map((function(e){return e.trim()})).filter((function(e){return""!==e&&"scene"!==e&&">"!==e}));var u=a-1;c.forEach((function(e){var n=e.split("\n"),r=n[0].trim();/^\d/.exec(r)?(u=parseFloat(r),n.shift()):u+=1;var a={scene:u};a.markup=b.parse(n.join("\n"));var o={};Object.keys(a.markup).forEach((function(e){/^#/.exec(e)?(void 0===t.leakedBaseMarkup[e]&&(t.leakedBaseMarkup[e]={}),Object.keys(a.markup[e]).forEach((function(n){t.leakedBaseMarkup[e][n]=a.markup[e][n]}))):o[e]=a.markup[e]})),a.markup=o,t.scenes.push(a)}))}return void 0!==t.scenes[0]?(void 0!==t.stage&&(t.stage.scene=t.scenes[0].scene),t.firstScene=t.scenes[0].scene,t.lastScene=t.scenes.slice(-1)[0].scene):(void 0!==t.stage&&(t.stage.scene=a),t.firstScene=a,t.lastScene=a),t}}],null&&T(n.prototype,null),r&&T(n,r),e}();function M(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function I(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const R=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(e,n){var r={timeline:[]},t=n;void 0===t&&(t=0);var a=e.replace(/.*?\[/,""),o=(a=a.replace(/\].*/,"")).split(">");return(o=o.map((function(e){return e.split("\n").join(" ").replace(/\s+/g," ").trim()})).filter((function(e){return""!==e.trim()}))).forEach((function(e){var n=e.split(/\s+/),a=[];/^\d/.exec(n[0])&&a.push(n.shift()),a.length>0&&/^\d/.exec(n[0])&&a.push(n.shift());var o="f\n  ".concat(n.join(" ")),i=b.parseSection(o);a.forEach((function(e){if(/\//.exec(e)){var n=(a=e.split("/"),o=2,function(e){if(Array.isArray(e))return e}(a)||function(e,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],t=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(t=(i=c.next()).done)&&(r.push(i.value),!n||r.length!==n);t=!0);}catch(e){a=!0,o=e}finally{try{t||null==c.return||c.return()}finally{if(a)throw o}}return r}}(a,o)||function(e,n){if(e){if("string"==typeof e)return M(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(e,n):void 0}}(a,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],t=n[1];void 0===i.properties.column&&(i.properties.column=parseFloat(r)),void 0===i.properties.row&&(i.properties.row=parseFloat(t))}else void 0===i.properties.scene&&(i.properties.scene=parseInt(e,10));var a,o})),void 0===i.properties.scene?(t+=1,i.properties.scene=t):t=i.properties.scene,r.timeline.push(i.properties)})),r.previousScene=t,r}}],null&&I(n.prototype,null),r&&I(n,r),e}();function B(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function L(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const V=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(e){var n,r=l.parse(e),t=0,a=0,o=0,i=0,c={scenes:[],stages:[],meta:{}},u=[];void 0!==r.sections&&r.sections.forEach((function(e){var r,l,s=F.parse(e,t,n);u.push(s.leakedBaseMarkup),n=s.columnMap,t=s.lastScene,s.columnMap&&s.columnMap.lastColumn>o&&(o=s.columnMap.lastColumn),s.lastScene>a&&(a=s.lastScene),void 0!==s.lastRow&&s.lastRow>i&&(i=s.lastRow),void 0!==s.scenes&&s.scenes.length>0&&(r=c.scenes).push.apply(r,function(e){if(Array.isArray(e))return B(e)}(l=s.scenes)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(l)||function(e,n){if(e){if("string"==typeof e)return B(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?B(e,n):void 0}}(l)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),void 0!==s.stage&&c.stages.push(s.stage)})),c.markup=b.parse(r.markup),u.forEach((function(e){Object.keys(e).forEach((function(n){void 0===c.markup[n]&&(c.markup[n]={}),Object.keys(e[n]).forEach((function(r){void 0===c.markup[n][r]&&(c.markup[n][r]=e[n][r])}))}))}));var s=[];return c.scenes.forEach((function(e){Object.keys(e.markup).forEach((function(n){var r=0;if(void 0!==e.scene&&(r=e.scene-1),void 0!==e.markup[n].flow){var t=R.parse(e.markup[n].flow,r);r=t.previousScene,s.push({id:n,timeline:t.timeline}),delete e.markup[n].flow,0===Object.keys(e.markup[n]).length&&delete e.markup[n]}}))})),Object.keys(c.markup).forEach((function(e){var n=0;if(void 0!==c.markup[e].flow){var r=R.parse(c.markup[e].flow,n);n=r.previousScene,s.push({id:e,timeline:r.timeline}),delete c.markup[e].flow,0===Object.keys(c.markup[e]).length&&delete c.markup[e]}})),s.forEach((function(e){e.timeline.forEach((function(n){var r=n.scene-1;n.scene>a&&(a=n.scene),void 0===c.scenes[r]&&(c.scenes[r]={scene:n.scene,markup:{}}),void 0===c.scenes[r].markup[e.id]&&(c.scenes[r].markup[e.id]={}),Object.keys(n).forEach((function(t){"scene"!==t&&(c.scenes[r].markup[e.id][t]=n[t],"row"===t&&n[t]>i&&(i=n[t]),"column"===t&&n[t]>o&&(o=n[t]))}))}))})),c.meta.lastScene=a,c.meta.lastColumn=o,c.meta.lastRow=i,Object.keys(c.markup).forEach((function(e){if(!/^#|^\*/.exec(e)){var n=!0;c.scenes.forEach((function(r){Object.keys(r.markup).includes(e)&&(n=!1)})),c.stages.forEach((function(r){r.elements.forEach((function(r){r.id===e&&(n=!1)}))})),!0===n&&(void 0===c.scenes[0]&&(c.scenes[0]={scene:1,markup:{}}),c.scenes[0].markup[e]=c.markup[e],delete c.markup[e])}})),c}}],null&&L(n.prototype,null),r&&L(n,r),e}();function W(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function q(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?W(Object(r),!0).forEach((function(n){U(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function U(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function $(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var G={"*":{"text-color":"black","background-color":"white"},"#stage":{"background-color":"black",width:600,height:400,"show-grid?":!1},"#player":{"repeat?":!1,"rewind?":!1}};const D=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"parse",value:function(n){var r=V.parse(n),t={scenes:[],markup:{}},a=JSON.parse(JSON.stringify(G));Object.keys(a).forEach((function(e){Object.keys(a[e]).forEach((function(n){/color/.exec(n)&&(a[e][n]=p.parse(a[e][n]))}))})),a["#stage"].columns=r.meta.lastColumn,a["#stage"].rows=r.meta.lastRow;var o=q({},a),i=q({},a);Object.keys(r.markup).forEach((function(e){void 0===o[e]&&(o[e]={}),Object.keys(r.markup[e]).forEach((function(n){o[e][n]=r.markup[e][n]})),/^#/.exec(e)&&(void 0===i[e]&&(i[e]={}),Object.keys(r.markup[e]).forEach((function(n){i[e][n]=r.markup[e][n]})))})),t.markup=i;var c={},u={};return r.stages.forEach((function(n){var r=n.scene.toString();void 0===c[r]&&(c[r]={}),n.elements.forEach((function(n){var t=n.id;void 0===c[r][t]&&(c[r][t]={markup:e.buildBaseMarkupFor(t,o,u)}),c[r][t].markup.row=n.row,c[r][t].markup.column=n.column,Object.keys(n.markup).forEach((function(e){c[r][t].markup[e]=n.markup[e]}))}))})),r.scenes.forEach((function(n){var r=n.scene.toString();void 0===c[r]&&(c[r]={}),Object.keys(n.markup).forEach((function(t){"*"!==t&&(void 0===c[r][t]&&(c[r][t]={markup:e.buildBaseMarkupFor(t,o,u)}),void 0!==n.markup["*"]&&Object.keys(n.markup["*"]).forEach((function(e){c[r][t].markup[e]=n.markup["*"][e]})),Object.keys(n.markup[t]).forEach((function(e){c[r][t].markup[e]=n.markup[t][e]})))}))})),Object.keys(c).map((function(e){return parseInt(e,10)})).sort().map((function(e){return e.toString()})).forEach((function(e){var n=[];Object.keys(c[e]).forEach((function(r){var t=c[e][r];t.id=r,n.push(t)})),t.scenes.push(n)})),delete t.markup["*"],t.resources={fonts:[]},t.scenes.forEach((function(e){e.forEach((function(e){Object.keys(e.markup).forEach((function(n){"text-font"===n&&(t.resources.fonts.includes(e.markup[n])||t.resources.fonts.push(e.markup[n]))}))}))})),t}},{key:"buildBaseMarkupFor",value:function(e,n,r){var t={};return r[e]||(void 0!==n["*"]&&Object.keys(n["*"]).forEach((function(e){t[e]=n["*"][e]})),void 0!==n[e]&&Object.keys(n[e]).forEach((function(r){t[r]=n[e][r]})),r[e]=!0),t}}],null&&$(n.prototype,null),r&&$(n,r),e}();function N(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const z=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"draw",value:function(e,n,r){for(var t=16777215,a=new r.Container,o=e.width/(e.columns+1),i=e.height/(e.rows+1),c=0;c<e.rows;c+=1){var u=c+1,l=new r.Graphics;a.addChild(l);var s=i*u,f=e.width,p=i*u;l.position.set(0,0),l.lineStyle(.5,t).moveTo(0,s).lineTo(f,p)}for(var d=0;d<e.columns;d+=1){var m=d+1,v=new r.Graphics;a.addChild(v);var h=o*m,b=o*m,y=e.height;v.position.set(0,0),v.lineStyle(.5,t).moveTo(h,0).lineTo(b,y)}n.addChild(a)}}],null&&N(n.prototype,null),r&&N(n,r),e}();function Y(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const J=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.xPerColumn=n.width/(n.columns+1),this.yPerRow=n.height/(n.rows+1)}var n,r;return n=e,(r=[{key:"xFor",value:function(e){return this.xPerColumn*e}},{key:"yFor",value:function(e){return this.yPerRow*e}}])&&Y(n.prototype,r),e}();function X(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const _=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"player",value:function(n){var r=n;r.app=e.app(r.target,r.markup["#stage"],r.dependencies),r.descartes=new J(r.markup["#stage"]),r.mainContainer=new r.dependencies.pixi.Container,r.mainContainer.visible=!1,r.app.stage.addChild(r.mainContainer),r.markup["#stage"]["show-grid?"]&&z.draw(r.markup["#stage"],r.mainContainer,r.dependencies.pixi)}},{key:"buildApplication",value:function(e,n){var r;try{r=new n.pixi.Application(e)}catch(t){r=new n.pixiLegacy.Application(e)}return r}},{key:"app",value:function(n,r,t){var a={width:r.width,height:r.height,antialias:!0,autoResize:!0,backgroundColor:r["background-color"]},o=e.buildApplication(a,t);return n.appendChild(o.view),o}}],null&&X(n.prototype,null),r&&X(n,r),e}();function H(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const K=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"draw",value:function(e,n){var r=new n.Container,t=16073303;void 0!==e.markup["background-color"]&&(t=e.markup["background-color"]);var a=new n.Graphics;a.beginFill(t),a.drawCircle(0,0,32),a.endFill(),r.addChild(a);var o={};return o.container=r,o.graphic=a,o}}],null&&H(n.prototype,null),r&&H(n,r),e}();function Q(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const Z=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"build",value:function(e,n){var r,t=16777215;void 0!==e.markup["text-font"]&&(r=e.markup["text-font"]),void 0!==e.markup.color&&(t=e.markup.color);var a={fontSize:38,fill:16777215,align:"center"};void 0!==r&&(a.fontFamily=r);var o=new n.TextStyle(a),i=new n.Text(e.markup["text-content"],o);return i.x=-i.width/2,i.y=-i.height/2,i.tint=t,i}}],null&&Q(n.prototype,null),r&&Q(n,r),e}();function ee(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const ne=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"draw",value:function(e,n){var r=new n.Container,t=Z.build(e,n);r.addChild(t);var a={};return a.container=r,a.text=t,a}}],null&&ee(n.prototype,null),r&&ee(n,r),e}();function re(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const te=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"draw",value:function(e,n){var r=new n.Container,t=Z.build(e,n),a=16073303;void 0!==e.markup["background-color"]&&(a=e.markup["background-color"]);var o=new n.Graphics;o.beginFill(a),o.drawCircle(0,0,32),o.endFill(),r.addChild(o),r.addChild(t);var i={};return i.container=r,i.graphic=o,i.text=t,i}}],null&&re(n.prototype,null),r&&re(n,r),e}();function ae(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}const oe=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"ensure",value:function(e,n,r){var t,a=e;if(a.library[n.id])return!0;var o=n.markup["text-content"];t=void 0!==o&&o.length>1?ne.draw(n,a.dependencies.pixi):void 0!==o?te.draw(n,a.dependencies.pixi):K.draw(n,a.dependencies.pixi),a.library[n.id]={raisedAt:r,object:t};var i=a.library[n.id].object;return i.container.x=a.descartes.xFor(n.markup.column),i.container.y=a.descartes.yFor(n.markup.row),"scene1"!==r&&(i.container.visible=!1),"show"===n.markup.motion&&(i.container.scale=0),a.mainContainer.addChild(i.container),!1}},{key:"updateText",value:function(e,n){var r=e;r.text=n,r.x=-r.width/2,r.y=-r.height/2}}],null&&ae(n.prototype,null),r&&ae(n,r),e}();function ie(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var ce={"background-color":"fillColor"},ue={"text-color":"tint"};const le=function(){function e(n,r,t,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=n,this.scenes=r.scenes,this.markup=r.markup,this.dependencies=t,this.resources=r.resources,this.callbacks=a,void 0===this.callbacks&&(this.callbacks={}),this.library={}}var n,r;return n=e,(r=[{key:"setup",value:function(){_.player(this)}},{key:"render",value:function(){var e=this;if(0===this.resources.fonts.length||void 0===this.dependencies.font)this.renderTimeline();else{var n=[],r=this.dependencies.font;this.resources.fonts.forEach((function(e){var t=new r(e);n.push(t)})),Promise.all(n.map((function(e){return e.load(null,void 0)}))).then((function(){e.renderTimeline()})).catch((function(n){throw new Error("Fonts are not available: [".concat(e.resources.fonts.join(", "),"]: ").concat(n))}))}}},{key:"renderTimeline",value:function(){var e=this,n=this.markup["#player"]["repeat?"];!0===n&&(n=-1);var r={repeat:n,repeatDelay:0,yoyo:this.markup["#player"]["rewind?"]};void 0!==this.callbacks.recorderFinish&&(this.recorderFinished=!1,!1!==n&&this.markup["#player"]["rewind?"]?1===n?r.onComplete=function(){e.recorderFinished||(e.recorderFinished=!0,e.callbacks.recorderFinish())}:(this.recorderWaiting=0,r.onRepeat=function(){e.recorderFinished||1!==e.recorderWaiting?e.recorderWaiting+=1:(e.recorderFinished=!0,e.callbacks.recorderFinish())}):!1===n||this.markup["#player"]["rewind?"]?r.onComplete=function(){e.recorderFinished||(e.recorderFinished=!0,e.callbacks.recorderFinish())}:r.onRepeat=function(){e.recorderFinished||(e.recorderFinished=!0,e.callbacks.recorderFinish())}),this.timeline=this.dependencies.gsap.timeline(r),this.timeline.pause();var t=this;this.timeline.add((function(){Object.keys(t.library).forEach((function(e){"scene1"!==t.library[e].raisedAt?t.library[e].object.container.visible=!1:t.library[e].object.container.visible=!0})),t.mainContainer.visible=!0})),this.timeline.to({},.2,{}),this.scenes.forEach((function(n,r){var t="scene".concat(r+1);e.renderScene(n,t)})),void 0!==this.callbacks.recorderSetup&&this.callbacks.recorderSetup(),this.timeline.to({},.2,{}),void 0!==this.callbacks.recorderStart&&this.callbacks.recorderStart(),this.timeline.play()}},{key:"renderScene",value:function(e,n){var r=this;e.forEach((function(e){var t=oe.ensure(r,e,n),a=r.library[e.id],o=a.object;t||"scene1"===n||(r.timeline.add((function(){o.container.visible=!1}),n),r.timeline.add((function(){o.container.visible=!0}),n));var i={x:r.descartes.xFor(e.markup.column),y:r.descartes.yFor(e.markup.row)};"show"===e.markup.motion?i.scale=1:"hide"===e.markup.motion&&(i.scale=0),void 0!==e.markup["text-content"]&&r.timeline.add((function(){oe.updateText(o.text,e.markup["text-content"])})),r.timeline.to(o.container,{duration:.8,ease:"power4.out",pixi:i},n);var c={};Object.keys(ce).forEach((function(n){void 0!==e.markup[n]&&(c[ce[n]]=e.markup[n])})),void 0!==o.graphic&&Object.keys(c).length>0&&r.timeline.to(o.graphic,{duration:.8,ease:"power4.out",pixi:c},n);var u={};if(Object.keys(ue).forEach((function(n){void 0!==e.markup[n]&&(u[ue[n]]=e.markup[n])})),void 0!==o.text&&Object.keys(u).length>0&&r.timeline.to(o.text,{duration:.8,ease:"power4.out",pixi:u},n),void 0===e.markup["text-content"]&&void 0!==a.previousContent){var l=a.previousContent;r.timeline.add((function(){oe.updateText(o.text,l)}))}else void 0!==e.markup["text-content"]&&(r.timeline.add((function(){oe.updateText(o.text,e.markup["text-content"])})),a.previousContent=e.markup["text-content"])}))}}])&&ie(n.prototype,r),e}();function se(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function fe(e,n,r){return n&&se(e.prototype,n),r&&se(e,r),e}var pe="0.0.1",de=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.dependencies=new o(n),this.VERSION=pe}return fe(e,null,[{key:"version",value:function(){return pe}}]),fe(e,[{key:"version",value:function(){return this.VERSION}},{key:"render",value:function(e,n,r){var t=D.parse(e),a=new le(n,t,this.dependencies,r);a.setup(),a.render()}},{key:"renderFile",value:function(e,n,r){var t=this;fetch(e,{headers:{"Content-Type":"text/plain; charset=utf-8"}}).then((function(e){return e.text()})).then((function(e){t.render(e,n,r)})).catch((function(e){throw e}))}}]),e}();de.VERSION=pe;const me=de}},n={};function r(t){if(n[t])return n[t].exports;var a=n[t]={exports:{}};return e[t](a,a.exports,r),a.exports}return r.d=(e,n)=>{for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(9)})()}));